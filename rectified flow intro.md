Rectified flow is a method for learning transport maps between two distributions, offers a new perspective on understanding diffusion models and their ODE variants. Distinct from the complex SDE models, rectified flow is purely ODE-based, offering a straightforward and unified framework for generative and transfer modeling. Given the infinite possibilities of ODEs/SDEs to transfer data between two distributions, rectified flow specifically advocates for ODEs with solution paths that are straight lines. By learning straight flows, it provides a principled approach to learning ODEs with fast inference, effectively training one-step models with ODEs as intermediate steps. Rectified Flow (RF) formulation is employed in the Stable Diffusion 3.

Given two distributions $\pi_0$ and $\pi_1$, probability flow models implicitly learns the transport map by constructing an ODE driven by a drift force in $\mathbb R^d \times [0,1]$:

$$\mathrm d \mathbf Z_t = \mathbf v(\mathbf Z_t , t) \, \mathrm dt, \quad t \in [0,1], \quad \text{starting from }\mathbf Z_0 \sim \mathbf\pi_0$$

such that $\mathbf Z_1 \sim \pi_1$ when following the ODE starting from $\mathbf Z_0 \sim \pi_0$. Generally, for any time-differentiable process $\mathbf X(t)$, $\mathbf v$ can be estimated by solving:
$$
\min_{\mathbf v} \int_0^1  \mathbb{E}\left [\lVert{\dot{\mathbf X}_t - \mathbf v(\mathbf X_t, t)}\rVert^2\right] \,\mathrm{d}t.
$$
By injecting strong priors that intermediate trajectories are straight in rectified flow, it can achieve both theoretical relevance for optimal transport [https://arxiv.org/abs/2209.14577] and computational efficiency, as ODEs with straight paths can be simulated precisely without time discretization. 

Specifically, rectified flow seeks to match an ODE with the marginal distributions of the **linear interpolation** between points from distributions $\pi_0$ and $\pi_1$. Given observations $\mathbf{X}_0 \sim \pi_0$ and $\mathbf{X}_1 \sim \pi_1$, the canonical linear interpolation $\mathbf{X}_t=t\mathbf{X}_1 + (1-t)\mathbf{X}_0, t\in [0,1]$ yields a trivial case $\dot{\mathbf X}_t = \mathbf X_1 - \mathbf X_0$, which cannot be causally simulated without $\mathbf{X}_1$. To address this, $\mathbf{X}_t$ is "projected" into a space of causally simulatable ODEs, expressed as $\mathrm{d}\mathbf{Z}_t = \mathbf{v}(\mathbf{Z}_t, t)$, by minimizing the least squares loss with respect to the direction $\mathbf{X}_1 - \mathbf{X}_0$:

$$\min_{\mathbf v} \int_0^1  \mathbb{E}\left [\lVert{(\mathbf X_1-\mathbf X_0) - \mathbf v(\mathbf X_t, t)}\rVert^2\right] \,\mathrm{d}t.$$

The data pair $(\mathbf{X}_0, \mathbf X_1)$ can be any coupling of $\pi_0$ and $\pi_1$, typically independent (i.e., $(\mathbf X_0,\mathbf X_1) \sim \pi_0 \times \pi_1$) obtained by randomly combining observations from $\pi_0$ and $\pi_1$. This process ensures that the $\mathbf{Z}_t$ trajectories closely mirror the density map of $\mathbf{X}_t$​ trajectories but *reroute* at intersections to ensure causality. This rectifying process is also referred to as Flow Matching, Stochastic Interpolation, and Alpha-Blending.

A distinctive aspect of rectified flow is its capability for "reflow", which straightens the trajectory of ODE paths. Denote the rectified flow $\boldsymbol Z^0 = \{ \mathbf Z_t: t\in[0,1]\}$ induced from $(\mathbf X_0,\mathbf X_1)$ as $\boldsymbol Z^0 = \mathsf{Rectflow}((\mathbf X_0,\mathbf X_1))$. Recursively applying this $\mathsf{Rectflow}(\cdot)$ operator generates a series of rectified flows $\boldsymbol Z^{k+1} = \mathsf{Rectflow}((\mathbf Z_0^k, \mathbf Z_1^k))$, starting with $(\mathbf Z_0^0,\mathbf Z_1^0)=(\mathbf X_0,\mathbf X_1)$, where $\boldsymbol Z^k$ is the $k$-th iteration of rectified flow induced from $(\mathbf X_0,\mathbf X_1)$. This "reflow" process not only reduces transport costs but also straightens the paths of rectified flows, making $\boldsymbol Z^k$ paths straighter with increasing $k$​.

Rectified flow includes a nonlinear extension where linear interpolation $\mathbf{X}_t$ is replaced with any time-differentiable curve that connects $\mathbf{X}_0$ and $\mathbf{X}_1$, given by $\mathbf{X}_t = \alpha_t \mathbf{X}_1 + \beta_t \mathbf{X}_0$ This framework encompasses DDIM and probability flow ODEs as special cases,  with particular choices of $\alpha_t$ and $\beta_t$. However, in the case when the path of $\mathbf{X}$ is not straight, the pair $(\mathbf{Z}_0, \mathbf{Z}_1)$ no longer ensures a reduction in convex transport costs, and the reflow process also no longer straighten the paths of $\mathbf{Z}_t$.

Flows with nearly straight paths offer a significant computational benefit by minimizing time-discretization errors in numerical simulations. Specifically, if an ODE $\mathrm{d} \mathbf Z_t =\mathbf v(\mathbf Z_t,t)\; \mathrm{d}t$ follows perfectly straight paths, it simplifies to $\mathbf Z_t = \mathbf Z_0 + t \cdot\mathbf v(\mathbf Z_0, 0),$ allowing for exact solutions with just **one single Euler step**. This addresses the very bottleneck of slow inference in ODE/SDE models. Consequently, the reflow/straightening procedure emerges as a unique strategy for training one-step generative models, such as GANs and VAEs, using ODEs as an intermediate mechanism. 



